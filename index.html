<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내돈얼마 - 아파트 매수 필요 현금 & 대출 DSR 계산기</title>
    <meta name="description" content="아파트 매수 시 필요한 현금, 취득세, 중개수수료, 주담대 LTV 및 DSR 한도를 한눈에 계산해 보세요. 내 집 마련을 위한 필수 부동산 계산기 '내돈얼마'입니다.">
    <meta name="keywords" content="부동산 계산기, 아파트 매수, 내집마련, DSR 계산기, LTV 계산기, 취득세 계산기, 갭투자 계산기, 내돈얼마">
    <meta property="og:title" content="내돈얼마 - 내 집 마련 필수 현금 계산기">
    <meta property="og:description" content="매매가와 연봉만 입력하면 대출 한도와 필요 현금을 즉시 확인하세요.">
    <meta property="og:type" content="website">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 font-sans antialiased transition-colors duration-200">

<header class="w-full bg-white dark:bg-slate-800 shadow-sm border-b border-slate-200 dark:border-slate-700 transition-colors duration-200">
    <div class="max-w-7xl mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
        <div class="flex items-center gap-2">
            <svg class="w-8 h-8 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 12h3v8h6v-6h2v6h6v-8h3L12 2zm0 2.83l5 5V18h-2v-6H9v6H7v-8.17l5-5z"/></svg>
            <h1 class="text-2xl font-extrabold tracking-tight text-blue-600 dark:text-blue-400">내돈얼마<span class="hidden sm:inline text-sm font-medium text-slate-500 dark:text-slate-400 ml-2">부동산 계산기</span></h1>
        </div>
        <button id="theme-toggle" class="p-2 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg id="theme-icon-dark" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
            <svg id="theme-icon-light" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path></svg>
        </button>
    </div>
</header>

<div class="max-w-7xl mx-auto p-4 md:p-8 flex flex-col lg:flex-row gap-6">
    
    <div class="w-full lg:w-1/3 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 h-fit transition-colors duration-200">
        <h2 class="text-xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b dark:border-slate-700 pb-2">매수 조건 입력</h2>
        
        <!-- 계산 모드 토글 -->
        <div class="flex p-1 bg-slate-100 dark:bg-slate-700 rounded-xl mb-6">
            <button id="btn-mode-price" class="flex-1 py-2 text-sm font-bold rounded-lg bg-white dark:bg-slate-600 shadow-sm text-blue-600 dark:text-blue-400 transition-all">매매가 기준</button>
            <button id="btn-mode-cash" class="flex-1 py-2 text-sm font-bold rounded-lg text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 transition-all">보유 현금 기준</button>
        </div>

        <div class="space-y-5">
            <!-- 매매가 기준 입력 섹션 -->
            <div id="section-price-input" class="space-y-5">
                <div>
                    <label class="block text-sm font-semibold mb-1">매매가 (만 원)</label>
                    <input type="number" id="input-price" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 100000 (10억)" value="100000">
                    <div id="disp-price" class="text-xs text-blue-600 dark:text-blue-400 mt-1 font-medium text-right">10억 0만 원</div>
                </div>

                <div>
                    <label class="block text-sm font-semibold mb-1">전세가 (만 원)</label>
                    <input type="number" id="input-jeonse" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 60000 (6억)" value="60000">
                    <div id="disp-jeonse" class="text-xs text-blue-600 dark:text-blue-400 mt-1 font-medium text-right">6억 0만 원</div>
                </div>
            </div>

            <!-- 보유 현금 기준 입력 섹션 -->
            <div id="section-cash-input" class="hidden space-y-5">
                <div>
                    <label class="block text-sm font-semibold mb-1">보유 현금 (만 원)</label>
                    <input type="number" id="input-cash" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 40000 (4억)" value="40000">
                    <div id="disp-cash" class="text-xs text-blue-600 dark:text-blue-400 mt-1 font-medium text-right">4억 0만 원</div>
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-1">희망 전세가율 (%) <span class="text-[10px] font-normal text-slate-400">(갭 투자용)</span></label>
                    <input type="number" id="input-jeonse-rate" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 60" value="60">
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold mb-1">연봉 (만 원)</label>
                <input type="number" id="input-income" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 8000 (8천만 원)" value="8000">
                <div id="disp-income" class="text-xs text-blue-600 dark:text-blue-400 mt-1 font-medium text-right">8,000만 원</div>
            </div>

            <div class="flex gap-4">
                <div class="flex-1">
                    <label class="block text-sm font-semibold mb-1">대출 금리 (%)</label>
                    <input type="number" id="input-interest" step="0.1" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 4.2" value="4.2">
                </div>
                <div class="flex-1">
                    <label class="block text-sm font-semibold mb-1">대출 기간 (년)</label>
                    <input type="number" id="input-term" class="w-full bg-transparent border border-slate-300 dark:border-slate-600 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all dark:text-white" placeholder="예: 40" value="40">
                </div>
            </div>
            <div class="text-xs text-slate-400 dark:text-slate-500 text-right -mt-4">* 스트레스 금리 별도 가산</div>

            <div>
                <label class="block text-sm font-semibold mb-1">상환 방법</label>
                <div class="grid grid-cols-1 gap-2">
                    <label class="flex items-center gap-3 cursor-pointer p-2 border dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                        <input type="radio" name="repayment" value="equal-total" class="w-4 h-4 text-blue-600 focus:ring-blue-500" checked>
                        <span class="text-sm text-slate-700 dark:text-slate-300 font-medium">원리금균등 <span class="text-[10px] font-normal text-slate-400">(매달 같은 금액)</span></span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer p-2 border dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                        <input type="radio" name="repayment" value="equal-principal" class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                        <span class="text-sm text-slate-700 dark:text-slate-300 font-medium">원금균등 <span class="text-[10px] font-normal text-slate-400">(원금 일정, 이자 감소)</span></span>
                    </label>
                    <label class="flex items-center gap-3 cursor-pointer p-2 border dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                        <input type="radio" name="repayment" value="grace" class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                        <span class="text-sm text-slate-700 dark:text-slate-300 font-medium">거치식 <span class="text-[10px] font-normal text-slate-400">(초기 이자만 납부)</span></span>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold mb-1">지역 규제</label>
                <div class="flex gap-2">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="regulation" value="false" class="peer hidden" checked>
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">비규제지역</div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="regulation" value="true" class="peer hidden">
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">규제지역</div>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold mb-1">주택 보유 수 (매수 후)</label>
                <div class="flex gap-2">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="homes" value="0" class="peer hidden" checked>
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">무주택</div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="homes" value="1" class="peer hidden">
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">1주택</div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="homes" value="2" class="peer hidden">
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">다주택(2+)</div>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold mb-1">전용 면적</label>
                <div class="flex gap-2">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="area" value="small" class="peer hidden" checked>
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">85㎡ 이하</div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="area" value="large" class="peer hidden">
                        <div class="text-center py-2 border dark:border-slate-600 rounded-lg peer-checked:bg-blue-50 dark:peer-checked:bg-blue-900/30 peer-checked:border-blue-500 peer-checked:text-blue-700 dark:peer-checked:text-blue-400 font-medium text-sm transition-all text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700">85㎡ 초과</div>
                    </label>
                </div>
            </div>

            <div class="pt-2">
                <label class="flex items-center gap-3 cursor-pointer p-3 bg-blue-50/50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 rounded-xl hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors">
                    <input type="checkbox" id="input-first-home" class="w-5 h-5 text-blue-600 rounded-md focus:ring-blue-500 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700">
                    <div>
                        <span class="block text-sm font-bold text-blue-800 dark:text-blue-300">생애최초 주택 구매</span>
                        <span class="block text-[10px] text-blue-600 dark:text-blue-400 font-medium">LTV 70% 우대 금리 적용 가능 여부</span>
                    </div>
                </label>
            </div>
        </div>
    </div>

    <div class="w-full lg:w-2/3 space-y-6">
        
        <div id="error-msg" class="hidden bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 text-red-700 dark:text-red-400 p-4 rounded shadow-sm font-medium transition-colors">
            전세가가 매매가보다 높습니다. 입력값을 확인하세요.
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 overflow-hidden relative transition-colors duration-200">
            <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
            <h2 class="text-2xl font-bold mb-4 text-slate-900 dark:text-slate-100 flex items-center justify-between">
                <span>시나리오 1: 실거주 매수 (주담대 활용)</span>
                <span class="text-sm font-normal text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-3 py-1 rounded-full">DSR 40% 적용</span>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600 transition-colors">
                    <div class="text-sm text-slate-500 dark:text-slate-400 mb-1">최대 대출 가능액 <span class="text-xs">(Min(LTV, DSR))</span></div>
                    <div id="out-loan-max" class="text-2xl font-bold text-slate-800 dark:text-slate-100">0원</div>
                    <div class="mt-2 text-xs text-slate-500 dark:text-slate-400 space-y-1">
                        <div class="flex justify-between"><span>LTV 한도:</span> <span id="out-ltv-limit" class="font-medium text-slate-700 dark:text-slate-300">0원</span></div>
                        <div class="flex justify-between"><span>DSR 한도 (스트레스 3단계):</span> <span id="out-dsr-limit" class="font-medium text-slate-700 dark:text-slate-300">0원</span></div>
                        <div class="flex justify-between font-bold text-blue-600 dark:text-blue-400 pt-1 border-t dark:border-slate-600"><span>DSR 계산 금리:</span> <span id="out-calc-rate">0.0%</span></div>
                    </div>
                </div>
                
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600 transition-colors">
                    <div class="text-sm text-slate-500 dark:text-slate-400 mb-1">총 부대비용</div>
                    <div id="out-fee-total-1" class="text-2xl font-bold text-slate-800 dark:text-slate-100">0원</div>
                    <details class="mt-2 text-xs text-slate-500 dark:text-slate-400 cursor-pointer">
                        <summary class="font-medium text-blue-600 dark:text-blue-400 outline-none">상세 내역 보기</summary>
                        <div class="mt-2 space-y-1 bg-white dark:bg-slate-800 p-3 border dark:border-slate-600 rounded shadow-sm">
                            <div class="flex justify-between"><span>취득세 등:</span> <span id="dtl-tax-1">0원</span></div>
                            <div class="flex justify-between"><span>중개수수료(VAT포함):</span> <span id="dtl-broker-1">0원</span></div>
                            <div class="flex justify-between"><span>국민주택채권할인:</span> <span id="dtl-bond-1">0원</span></div>
                            <div class="flex justify-between"><span>수입인지대:</span> <span id="dtl-stamp-1">0원</span></div>
                            <div class="flex justify-between"><span>법무사비용(추정):</span> <span id="dtl-legal-1">0원</span></div>
                        </div>
                    </details>
                </div>
            </div>

            <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 p-5 rounded-xl flex flex-col md:flex-row justify-between items-center gap-4 mb-6 transition-colors">
                <div class="text-blue-800 dark:text-blue-300 font-semibold text-lg">최종 필요 현금 (매매가 - 대출금 + 부대비용)</div>
                <div id="out-final-cash-1" class="text-3xl font-extrabold text-blue-700 dark:text-blue-400 tracking-tight">0원</div>
            </div>

            <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600 transition-colors">
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-sm font-semibold text-slate-700 dark:text-slate-300">월 예상 상환액 <span class="text-xs font-normal text-slate-500 dark:text-slate-400"></span></div>
                    </div>
                    <div id="out-monthly-payment" class="text-xl font-bold text-slate-800 dark:text-slate-100">0원</div>
                </div>

                <button id="toggle-schedule" class="mt-3 w-full flex items-center justify-center gap-1 text-xs text-slate-500 hover:text-blue-500 transition-colors py-1 border-t border-dashed border-slate-200 dark:border-slate-600">
                    상세 상환 스케줄 보기
                    <svg id="schedule-arrow" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>

                <div id="schedule-container" class="hidden mt-4 overflow-hidden transition-all">
                    <div class="max-h-80 overflow-y-auto rounded-lg border border-slate-200 dark:border-slate-600">
                        <table class="w-full text-[11px] text-left border-collapse">
                            <thead class="sticky top-0 bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300">
                                <tr>
                                    <th class="p-2 border-b dark:border-slate-600">회차</th>
                                    <th class="p-2 border-b dark:border-slate-600 text-right">상환금</th>
                                    <th class="p-2 border-b dark:border-slate-600 text-right">원금</th>
                                    <th class="p-2 border-b dark:border-slate-600 text-right">이자</th>
                                    <th class="p-2 border-b dark:border-slate-600 text-right">잔액</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-body" class="divide-y divide-slate-100 dark:divide-slate-700 text-slate-500 dark:text-slate-400">
                                <!-- JS content -->
                            </tbody>
                        </table>
                    </div>
                    <div class="text-[10px] text-slate-400 mt-2 text-center">* 위 스케줄은 단순 참고용이며 실제와 다를 수 있습니다.</div>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 overflow-hidden relative transition-colors duration-200">
            <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
            <h2 class="text-2xl font-bold mb-4 text-slate-900 dark:text-slate-100 flex items-center justify-between">
                <span>시나리오 2: 갭 투자 매수 (전세 승계)</span>
                <span id="out-jeonse-rate" class="text-sm font-bold text-emerald-700 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/50 px-3 py-1 rounded-full">전세가율 0%</span>
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600 transition-colors">
                    <div class="text-sm text-slate-500 dark:text-slate-400 mb-1">갭 금액 (매매가 - 전세가)</div>
                    <div id="out-gap-amount" class="text-2xl font-bold text-slate-800 dark:text-slate-100">0원</div>
                </div>
                
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-xl border border-slate-100 dark:border-slate-600 transition-colors">
                    <div class="text-sm text-slate-500 dark:text-slate-400 mb-1">총 부대비용</div>
                    <div id="out-fee-total-2" class="text-2xl font-bold text-slate-800 dark:text-slate-100">0원</div>
                    <details class="mt-2 text-xs text-slate-500 dark:text-slate-400 cursor-pointer">
                        <summary class="font-medium text-emerald-600 dark:text-emerald-400 outline-none">상세 내역 보기</summary>
                        <div class="mt-2 space-y-1 bg-white dark:bg-slate-800 p-3 border dark:border-slate-600 rounded shadow-sm">
                            <div class="flex justify-between"><span>취득세 등:</span> <span id="dtl-tax-2">0원</span></div>
                            <div class="flex justify-between"><span>중개수수료(VAT포함):</span> <span id="dtl-broker-2">0원</span></div>
                            <div class="flex justify-between"><span>국민주택채권할인:</span> <span id="dtl-bond-2">0원</span></div>
                            <div class="flex justify-between"><span>수입인지대:</span> <span id="dtl-stamp-2">0원</span></div>
                            <div class="flex justify-between"><span>법무사비용(추정):</span> <span id="dtl-legal-2">0원</span></div>
                        </div>
                    </details>
                </div>
            </div>

            <div class="bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800 p-5 rounded-xl flex flex-col md:flex-row justify-between items-center gap-4 transition-colors">
                <div class="text-emerald-800 dark:text-emerald-300 font-semibold text-lg">최종 필요 현금 (갭 금액 + 부대비용)</div>
                <div id="out-final-cash-2" class="text-3xl font-extrabold text-emerald-700 dark:text-emerald-400 tracking-tight">0원</div>
            </div>
        </div>

        <!-- SEO 및 콘텐츠 보강: 가이드 & FAQ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 transition-colors">
                <h3 class="text-lg font-bold mb-4 text-slate-900 dark:text-white flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    내 집 마련 핵심 가이드
                </h3>
                <div class="space-y-4 text-sm text-slate-600 dark:text-slate-400 leading-relaxed">
                    <p><strong>1. LTV(주택담보대출비율)란?</strong><br>주택 가격 대비 대출 가능한 비율입니다. 비규제지역 무주택자의 경우 최대 70%까지 가능합니다.</p>
                    <p><strong>2. DSR(총부채원리금상환비율)이란?</strong><br>연 소득 대비 모든 부채의 원리금 상환액 비율입니다. 현재 1금융권 기준 40%가 상한선입니다.</p>
                    <p><strong>3. 스트레스 DSR이란?</strong><br>향후 금리 인상 가능성을 고려해 가산 금리를 적용하여 대출 한도를 산정하는 제도입니다. 한도가 줄어드는 효과가 있습니다.</p>
                </div>
            </div>

            <!-- 부동산 뉴스 섹션 -->
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 transition-colors">
            <h3 class="text-lg font-bold mb-4 text-slate-900 dark:text-white flex items-center gap-2">
                <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                최근 1주일 주요 부동산 뉴스
            </h3>
            <div class="space-y-4">
                <a href="https://www.yna.co.kr" target="_blank" class="block group">
                    <div class="flex justify-between items-start gap-3">
                        <div class="flex-1">
                            <span class="text-[10px] text-blue-500 font-bold uppercase tracking-wider">대출 규제</span>
                            <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 group-hover:text-blue-500 transition-colors line-clamp-1">다주택자 대출 만기 연장 불허 검토... LTV 0% 적용 방안 논의</h4>
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1 line-clamp-2">금융당국이 수도권 및 규제지역 내 다주택자의 주담대 만기 연장을 제한하는 고강도 압박 카드를 검토 중입니다.</p>
                        </div>
                        <span class="text-[10px] text-slate-400 whitespace-nowrap">2026.02.25</span>
                    </div>
                </a>
                <div class="h-px bg-slate-100 dark:bg-slate-700"></div>
                <a href="https://www.hankyung.com" target="_blank" class="block group">
                    <div class="flex justify-between items-start gap-3">
                        <div class="flex-1">
                            <span class="text-[10px] text-orange-500 font-bold uppercase tracking-wider">시장 동향</span>
                            <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 group-hover:text-blue-500 transition-colors line-clamp-1">강남 3구·용산 집값 하락 전환... 양도세 중과 유예 종료 앞두고 매물 증가</h4>
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1 line-clamp-2">2년 가까이 이어온 상승세가 꺾이며 매수자 우위 시장으로 재편되는 양상입니다.</p>
                        </div>
                        <span class="text-[10px] text-slate-400 whitespace-nowrap">2026.02.24</span>
                    </div>
                </a>
                <div class="h-px bg-slate-100 dark:bg-slate-700"></div>
                <a href="https://www.hani.co.kr" target="_blank" class="block group">
                    <div class="flex justify-between items-start gap-3">
                        <div class="flex-1">
                            <span class="text-[10px] text-emerald-500 font-bold uppercase tracking-wider">금융 통계</span>
                            <h4 class="text-sm font-semibold text-slate-800 dark:text-slate-200 group-hover:text-blue-500 transition-colors line-clamp-1">주택가격전망지수 16p 급락... 3년 7개월 만에 최대 하락폭 기록</h4>
                            <p class="text-xs text-slate-500 dark:text-slate-400 mt-1 line-clamp-2">집값 상승 기대감이 크게 꺾이며 소비자 심리 지수가 108까지 떨어졌습니다.</p>
                        </div>
                        <span class="text-[10px] text-slate-400 whitespace-nowrap">2026.02.22</span>
                    </div>
                </a>
            </div>
            <div class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-700 text-center">
                <a href="news.html" class="text-xs text-slate-400 hover:text-blue-500 transition-colors font-medium inline-block">부동산 뉴스 더보기 →</a>
            </div>
        </div>

        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 transition-colors">
            <h3 class="text-lg font-bold mb-4 text-slate-900 dark:text-white flex items-center gap-2">
                <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.443 1.103m-3.13 0a1.5 1.5 0 113 0m-3 0a1.5 1.5 0 10-3 0M3 20a6 6 0 0112 0v1H3v-1z"></path></svg>
                자주 묻는 질문 (FAQ)
            </h3>
                <div class="space-y-4 text-sm text-slate-600 dark:text-slate-400">
                    <details class="cursor-pointer group">
                        <summary class="font-semibold text-slate-800 dark:text-slate-200 group-hover:text-blue-500 transition-colors">계산 결과가 정확한가요?</summary>
                        <p class="mt-2 pl-4 border-l-2 border-slate-200 dark:border-slate-700">본 계산기는 대략적인 참고용입니다. 실제 은행 상담 결과와 차이가 있을 수 있습니다.</p>
                    </details>
                    <details class="cursor-pointer group">
                        <summary class="font-semibold text-slate-800 dark:text-slate-200 group-hover:text-blue-500 transition-colors">부대비용에는 어떤 것들이 포함되나요?</summary>
                        <p class="mt-2 pl-4 border-l-2 border-slate-200 dark:border-slate-700">취득세, 지방교육세, 농특세, 중개보수, 채권 할인료, 수입인지대, 법무사 대행 수수료 등이 포함됩니다.</p>
                    </details>
                </div>
            </div>
        </div>
        
    </div>
</div>

<footer class="w-full bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 py-8 mt-12 transition-colors duration-200">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">© 2026 내돈얼마. All rights reserved.</p>
        <div class="flex justify-center gap-6 text-xs text-slate-400 dark:text-slate-500">
            <a href="#" class="hover:text-blue-500 underline transition-colors">이용약관</a>
            <a href="#" class="hover:text-blue-500 underline transition-colors">개인정보처리방침</a>
            <a href="mailto:support@example.com" class="hover:text-blue-500 underline transition-colors">문의하기</a>
        </div>
        <p class="mt-6 text-[10px] text-slate-300 dark:text-slate-600 max-w-2xl mx-auto leading-relaxed">
            주의: 본 사이트의 모든 계산 결과는 관련 법규와 통계에 기초한 추정치로, 실제 금융 거래 및 세금 고지 결과와 상이할 수 있습니다. 정확한 금액은 반드시 전문가와 상담하시기 바랍니다.
        </p>
    </div>
</footer>

<script>
/**
 * ==========================================
 * [테마 토글 로직 (다크/라이트 모드)]
 * ==========================================
 */
const themeToggleBtn = document.getElementById('theme-toggle');
const themeIconDark = document.getElementById('theme-icon-dark');
const themeIconLight = document.getElementById('theme-icon-light');

// 시스템 테마 또는 저장된 테마 확인
if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.classList.add('dark');
    themeIconLight.classList.remove('hidden');
} else {
    document.documentElement.classList.remove('dark');
    themeIconDark.classList.remove('hidden');
}

themeToggleBtn.addEventListener('click', function() {
    document.documentElement.classList.toggle('dark');
    
    if (document.documentElement.classList.contains('dark')) {
        localStorage.theme = 'dark';
        themeIconDark.classList.add('hidden');
        themeIconLight.classList.remove('hidden');
    } else {
        localStorage.theme = 'light';
        themeIconLight.classList.add('hidden');
        themeIconDark.classList.remove('hidden');
    }
});

/**
 * ==========================================
 * [내부 상태 관리]
 * ==========================================
 */
let currentMode = 'price'; // 'price' or 'cash'

/**
 * ==========================================
 * [내부 상수 설정]
 * ==========================================
 */
const CONSTANTS = {
    LOAN: {
        DSR_LIMIT: 0.4,           // DSR 40%
        STRESS_RATE: 0.012,       // 스트레스 금리 1.2% (Phase 3 예상)
        LTV: {
            REGULATED: { 0: 0.4, 1: 0.4, 2: 0.0 },     // 규제 (무주택, 1주택, 다주택)
            NON_REGULATED: { 0: 0.7, 1: 0.6, 2: 0.3 }  // 비규제 (무주택, 1주택, 다주택)
        }
    },
    // 부대비용 상수
    FEE: {
        BOND_MARKET_RATIO: 0.6,       // 시가표준액 = 매매가의 60% 가정
        BOND_BUY_RATIO: 0.021,        // 채권 매입 비율 (약 2.1%)
        BOND_DISCOUNT_RATE: 0.10,     // 채권 할인율 (10% 러프하게 고정)
        LEGAL_BASE_FEE: 15,           // 법무사 기본 보수액 (만 원)
        LEGAL_AGENCY_FEE: 15,         // 대행 수수료 등 추정치 (만 원)
        LEGAL_PROGRESSIVE_RATE: 0.0008 // 누진 보수 요율 (대략적인 산식)
    }
};

/**
 * ==========================================
 * [유틸리티 함수]
 * ==========================================
 */
// 만 원 단위를 억, 만 원으로 포맷팅
function formatMoney(manWon) {
    if (isNaN(manWon) || manWon <= 0) return '0원';
    
    const amount = Math.floor(manWon);
    const uk = Math.floor(amount / 10000);
    const man = amount % 10000;
    
    let result = '';
    if (uk > 0) {
        result += `${uk.toLocaleString()}억 `;
    }
    if (man > 0 || uk === 0) {
        result += `${man.toLocaleString()}만 `;
    }
    return result.trim() + '원';
}

function getDOMValue(id) {
    return Number(document.getElementById(id).value) || 0;
}

function getRadioValue(name) {
    const el = document.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : null;
}

/**
 * ==========================================
 * [부대비용 계산 로직]
 * ==========================================
 */
// 1. 취득세 (+지방교육세, 농어촌특별세) 산출
function calculateTax(price, isRegulated, homes, isLarge) {
    let rate = 0;
    let eduRate = 0;
    let ruralRate = isLarge ? 0.002 : 0; // 85초과면 농특세 0.2% 추가

    // 다주택자 중과세율 적용 (2026년 현행 기준 단순화)
    if (homes >= 2) {
        if (isRegulated) {
            rate = 0.12; 
        } else {
            rate = 0.08; 
        }
        eduRate = 0.004; 
    } else {
        // 1주택자 (무주택에서 1주택 됨)
        if (price <= 60000) {
            rate = 0.01;
            eduRate = 0.001;
        } else if (price <= 90000) {
            const priceUk = price / 10000;
            rate = (priceUk * (2/3) - 3) / 100;
            eduRate = rate * 0.1; 
        } else {
            rate = 0.03;
            eduRate = 0.003;
        }
    }

    const totalRate = rate + eduRate + ruralRate;
    return Math.floor(price * totalRate);
}

// 2. 중개수수료 산출 (법정 상한요율 적용 + VAT 10%)
function calculateBrokerFee(price) {
    let rate = 0;
    if (price < 20000) rate = 0.005; 
    else if (price < 90000) rate = 0.004;
    else if (price < 120000) rate = 0.005;
    else if (price < 150000) rate = 0.006;
    else rate = 0.007;

    const baseFee = price * rate;
    const vat = baseFee * 0.1;
    return Math.floor(baseFee + vat);
}

// 3. 국민주택채권 할인액 (즉시 매도 시)
function calculateBondDiscount(price) {
    const marketVal = price * CONSTANTS.FEE.BOND_MARKET_RATIO;
    const buyVal = marketVal * CONSTANTS.FEE.BOND_BUY_RATIO;
    return Math.floor(buyVal * CONSTANTS.FEE.BOND_DISCOUNT_RATE);
}

// 4. 수입인지대
function calculateStampDuty(price) {
    if (price > 100000) return 35; 
    if (price >= 10000) return 15; 
    return 0;
}

// 5. 법무사 비용 (추정)
function calculateLegalFee(price) {
    const base = CONSTANTS.FEE.LEGAL_BASE_FEE;
    const prog = price * CONSTANTS.FEE.LEGAL_PROGRESSIVE_RATE;
    const agency = CONSTANTS.FEE.LEGAL_AGENCY_FEE;
    return Math.floor(base + prog + agency);
}

// 총 부대비용 합계
function calculateTotalFees(price, isRegulated, homes, isLarge) {
    if (price <= 0) return 0;
    return calculateTax(price, isRegulated, homes, isLarge) +
           calculateBrokerFee(price) +
           calculateBondDiscount(price) +
           calculateStampDuty(price) +
           calculateLegalFee(price);
}

/**
 * ==========================================
 * [대출 계산 로직]
 * ==========================================
 */
// PMT 함수 (원리금균등상환액 산출)
function calculatePMT(rate, nper, pv) {
    if (rate === 0) return pv / nper;
    return (pv * rate * Math.pow(1 + rate, nper)) / (Math.pow(1 + rate, nper) - 1);
}

function generateAmortizationSchedule(loanAmount, annualRate, totalMonths, method) {
    const tbody = document.getElementById('schedule-body');
    if (!tbody) return;
    
    if (loanAmount <= 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center">대출액이 없습니다.</td></tr>';
        return;
    }

    const monthlyRate = annualRate / 12;
    let balance = loanAmount;
    let rows = '';

    for (let month = 1; month <= Math.min(totalMonths, 600); month++) {
        let interest = balance * monthlyRate;
        let principal = 0;
        let payment = 0;

        if (method === 'equal-total') {
            payment = calculatePMT(monthlyRate, totalMonths, loanAmount);
            principal = payment - interest;
        } else if (method === 'equal-principal') {
            principal = loanAmount / totalMonths;
            payment = principal + interest;
        } else if (method === 'grace') {
            principal = 0;
            payment = interest;
        }

        balance -= principal;
        if (balance < 0.01) balance = 0;

        rows += `
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-800/50">
                <td class="p-2 font-medium">${month}회</td>
                <td class="p-2 text-right">${Math.floor(payment).toLocaleString()}</td>
                <td class="p-2 text-right">${Math.floor(principal).toLocaleString()}</td>
                <td class="p-2 text-right">${Math.floor(interest).toLocaleString()}</td>
                <td class="p-2 text-right">${Math.floor(Math.max(0, balance)).toLocaleString()}</td>
            </tr>
        `;
        
        if (balance <= 0 && method !== 'grace') break;
    }
    tbody.innerHTML = rows;
}

// DSR 기반 최대 대출액
function getDsrLimit(income, calcRate, termYears) {
    if (income <= 0 || termYears <= 0) return 0;
    
    const maxYearlyPayment = income * CONSTANTS.LOAN.DSR_LIMIT;
    const monthlyRate = calcRate / 12;
    const totalMonths = termYears * 12;

    const maxMonthlyPayment = maxYearlyPayment / 12;
    const maxLoan = maxMonthlyPayment * ((Math.pow(1 + monthlyRate, totalMonths) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, totalMonths)));
    
    return Math.floor(maxLoan);
}

// LTV 기반 최대 대출액
function getLtvLimit(price, isRegulated, homes, isFirstHome) {
    let ltvRate = 0;
    if (isFirstHome) {
        ltvRate = 0.7; 
    } else if (isRegulated) {
        ltvRate = CONSTANTS.LOAN.LTV.REGULATED[homes];
    } else {
        ltvRate = CONSTANTS.LOAN.LTV.NON_REGULATED[homes];
    }
    return Math.floor(price * ltvRate);
}

/**
 * ==========================================
 * [역산 로직 (보유 현금 -> 매매가)]
 * ==========================================
 */
// 시나리오 1: 대출 활용 시 역산 (Binary Search)
function reversePriceWithLoan(targetCash, income, calcInterest, termYears, isRegulated, homes, isFirstHome, isLarge) {
    let low = 0;
    let high = 500000; // 최대 50억까지 검색
    let bestPrice = 0;

    for (let i = 0; i < 20; i++) { // 20회 반복으로 충분한 정밀도 확보
        let mid = (low + high) / 2;
        let ltvLimit = getLtvLimit(mid, isRegulated, homes, isFirstHome);
        let dsrLimit = getDsrLimit(income, calcInterest, termYears);
        let maxLoan = Math.min(ltvLimit, dsrLimit);
        if (mid >= 150000) maxLoan = Math.min(maxLoan, 60000); // 15억 규제 반영

        let fees = calculateTotalFees(mid, isRegulated, homes, isLarge);
        let requiredCash = mid - maxLoan + fees;

        if (requiredCash <= targetCash) {
            bestPrice = mid;
            low = mid;
        } else {
            high = mid;
        }
    }
    return Math.floor(bestPrice);
}

// 시나리오 2: 갭 투자 시 역산 (Binary Search)
function reversePriceWithGap(targetCash, jeonseRate, isRegulated, homes, isLarge) {
    let low = 0;
    let high = 500000;
    let bestPrice = 0;

    for (let i = 0; i < 20; i++) {
        let mid = (low + high) / 2;
        let gap = mid * (1 - jeonseRate / 100);
        let fees = calculateTotalFees(mid, isRegulated, homes, isLarge);
        let requiredCash = gap + fees;

        if (requiredCash <= targetCash) {
            bestPrice = mid;
            low = mid;
        } else {
            high = mid;
        }
    }
    return Math.floor(bestPrice);
}

/**
 * ==========================================
 * [메인 업데이트 함수]
 * ==========================================
 */
function updateDashboard() {
    // 1. 공통 입력값 가져오기
    const income = getDOMValue('input-income');
    const baseInterest = getDOMValue('input-interest') / 100;
    const termYears = getDOMValue('input-term') || 40;
    const isRegulated = getRadioValue('regulation') === 'true';
    const homes = parseInt(getRadioValue('homes'), 10);
    const isLarge = getRadioValue('area') === 'large';
    const isFirstHome = document.getElementById('input-first-home').checked;
    
    // DSR 계산 금리
    const calcInterest = baseInterest + CONSTANTS.LOAN.STRESS_RATE;
    document.getElementById('out-calc-rate').innerText = `${(calcInterest * 100).toFixed(2)}% (스트레스 포함)`;
    document.getElementById('disp-income').innerText = formatMoney(income);

    let price, jeonse, cash;

    if (currentMode === 'price') {
        price = getDOMValue('input-price');
        jeonse = getDOMValue('input-jeonse');
        document.getElementById('disp-price').innerText = formatMoney(price);
        document.getElementById('disp-jeonse').innerText = formatMoney(jeonse);
        
        // 타이틀 복구
        document.querySelector('#out-loan-max').previousElementSibling.innerHTML = '최대 대출 가능액 <span class="text-xs">(Min(LTV, DSR))</span>';
        document.querySelector('#out-final-cash-1').previousElementSibling.innerText = '최종 필요 현금 (매매가 - 대출금 + 부대비용)';
        document.querySelector('#out-gap-amount').previousElementSibling.innerText = '갭 금액 (매매가 - 전세가)';
        document.querySelector('#out-final-cash-2').previousElementSibling.innerText = '최종 필요 현금 (갭 금액 + 부대비용)';

    } else {
        cash = getDOMValue('input-cash');
        const jeonseRate = getDOMValue('input-jeonse-rate');
        document.getElementById('disp-cash').innerText = formatMoney(cash);

        // 역산 수행
        price = reversePriceWithLoan(cash, income, calcInterest, termYears, isRegulated, homes, isFirstHome, isLarge);
        const priceGap = reversePriceWithGap(cash, jeonseRate, isRegulated, homes, isLarge);
        
        // UI 텍스트 변경 (역산 모드)
        document.querySelector('#out-loan-max').previousElementSibling.innerHTML = '구매 가능 매매가 <span class="text-xs">(주담대 활용 시)</span>';
        document.querySelector('#out-final-cash-1').previousElementSibling.innerText = '입력하신 보유 현금';
        document.querySelector('#out-gap-amount').previousElementSibling.innerText = '구매 가능 매매가 (갭 투자 시)';
        document.querySelector('#out-final-cash-2').previousElementSibling.innerText = '입력하신 보유 현금';

        // 시나리오 1 결과 표시
        document.getElementById('out-loan-max').innerText = formatMoney(price);
        document.getElementById('out-final-cash-1').innerText = formatMoney(cash);

        // 시나리오 2 결과 표시
        document.getElementById('out-gap-amount').innerText = formatMoney(priceGap);
        document.getElementById('out-final-cash-2').innerText = formatMoney(cash);

        // 시나리오 2 전세가율 표시
        document.getElementById('out-jeonse-rate').innerText = `목표 전세가율 ${jeonseRate}%`;

        // 부대비용 계산을 위한 price 설정 (시나리오 1 기준)
        // (실제로는 시나리오 1과 2의 price가 다르지만, 상세 내역에는 시나리오 1 기준으로 표시)
        jeonse = price * (jeonseRate / 100);
    }

    // 2. 에러 핸들링
    const errorMsg = document.getElementById('error-msg');
    if (currentMode === 'price' && jeonse > price) {
        errorMsg.classList.remove('hidden');
    } else {
        errorMsg.classList.add('hidden');
    }

    // 3. 부대비용 산출 (현재 설정된 price 기준)
    const tax = calculateTax(price, isRegulated, homes, isLarge);
    const broker = calculateBrokerFee(price);
    const bond = calculateBondDiscount(price);
    const stamp = calculateStampDuty(price);
    const legal = calculateLegalFee(price);
    const totalIncidentalFee = tax + broker + bond + stamp + legal;

    [1, 2].forEach(num => {
        document.getElementById(`dtl-tax-${num}`).innerText = formatMoney(tax);
        document.getElementById(`dtl-broker-${num}`).innerText = formatMoney(broker);
        document.getElementById(`dtl-bond-${num}`).innerText = formatMoney(bond);
        document.getElementById(`dtl-stamp-${num}`).innerText = formatMoney(stamp);
        document.getElementById(`dtl-legal-${num}`).innerText = formatMoney(legal);
        document.getElementById(`out-fee-total-${num}`).innerText = formatMoney(totalIncidentalFee);
    });

    // 4. 시나리오 1 상세 (대출)
    const ltvLimit = getLtvLimit(price, isRegulated, homes, isFirstHome);
    const dsrLimit = getDsrLimit(income, calcInterest, termYears);
    let maxLoan = Math.min(ltvLimit, dsrLimit);
    if (price >= 150000) maxLoan = Math.min(maxLoan, 60000);

    if (currentMode === 'price') {
        const finalCash1 = price - maxLoan + totalIncidentalFee;
        document.getElementById('out-loan-max').innerText = formatMoney(maxLoan);
        document.getElementById('out-final-cash-1').innerText = formatMoney(Math.max(0, finalCash1));
    }

    document.getElementById('out-ltv-limit').innerText = formatMoney(ltvLimit);
    document.getElementById('out-dsr-limit').innerText = formatMoney(dsrLimit);

    // 월 상환액
    const repaymentMethod = getRadioValue('repayment');
    let monthlyPaymentManWon = 0;
    let paymentSuffix = "";
    const actualMonthlyRate = baseInterest / 12;
    const totalMonths = termYears * 12;

    if (repaymentMethod === 'equal-total') {
        monthlyPaymentManWon = calculatePMT(actualMonthlyRate, totalMonths, maxLoan);
    } else if (repaymentMethod === 'equal-principal') {
        const monthlyPrincipal = maxLoan / totalMonths;
        const firstMonthInterest = maxLoan * actualMonthlyRate;
        monthlyPaymentManWon = monthlyPrincipal + firstMonthInterest;
        paymentSuffix = " (첫 달)";
    } else if (repaymentMethod === 'grace') {
        monthlyPaymentManWon = maxLoan * actualMonthlyRate;
        paymentSuffix = " (거치 기간)";
    }
    document.getElementById('out-monthly-payment').innerText = `약 ${Math.floor(monthlyPaymentManWon).toLocaleString()}만 원${paymentSuffix}`;
    generateAmortizationSchedule(maxLoan, baseInterest, totalMonths, repaymentMethod);

    // 5. 시나리오 2 상세 (갭)
    if (currentMode === 'price') {
        const gapAmount = price - jeonse;
        const jeonseRate = price > 0 ? ((jeonse / price) * 100).toFixed(1) : 0;
        const finalCash2 = gapAmount + totalIncidentalFee;
        document.getElementById('out-gap-amount').innerText = formatMoney(gapAmount);
        document.getElementById('out-jeonse-rate').innerText = `전세가율 ${jeonseRate}%`;
        document.getElementById('out-final-cash-2').innerText = formatMoney(Math.max(0, finalCash2));
    }
}

/**
 * ==========================================
 * [이벤트 리스너 바인딩]
 * ==========================================
 */
document.addEventListener('DOMContentLoaded', () => {
    // 모드 전환
    const btnModePrice = document.getElementById('btn-mode-price');
    const btnModeCash = document.getElementById('btn-mode-cash');
    const sectionPriceInput = document.getElementById('section-price-input');
    const sectionCashInput = document.getElementById('section-cash-input');

    btnModePrice.addEventListener('click', () => {
        currentMode = 'price';
        btnModePrice.classList.add('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-blue-600', 'dark:text-blue-400');
        btnModePrice.classList.remove('text-slate-500', 'dark:text-slate-400');
        btnModeCash.classList.remove('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-blue-600', 'dark:text-blue-400');
        btnModeCash.classList.add('text-slate-500', 'dark:text-slate-400');
        sectionPriceInput.classList.remove('hidden');
        sectionCashInput.classList.add('hidden');
        updateDashboard();
    });

    btnModeCash.addEventListener('click', () => {
        currentMode = 'cash';
        btnModeCash.classList.add('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-blue-600', 'dark:text-blue-400');
        btnModeCash.classList.remove('text-slate-500', 'dark:text-slate-400');
        btnModePrice.classList.remove('bg-white', 'dark:bg-slate-600', 'shadow-sm', 'text-blue-600', 'dark:text-blue-400');
        btnModePrice.classList.add('text-slate-500', 'dark:text-slate-400');
        sectionPriceInput.classList.add('hidden');
        sectionCashInput.classList.remove('hidden');
        updateDashboard();
    });

    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', updateDashboard);
        input.addEventListener('change', updateDashboard);
    });

    const toggleBtn = document.getElementById('toggle-schedule');
    const scheduleContainer = document.getElementById('schedule-container');
    const scheduleArrow = document.getElementById('schedule-arrow');
    
    toggleBtn.addEventListener('click', () => {
        const isHidden = scheduleContainer.classList.contains('hidden');
        if (isHidden) {
            scheduleContainer.classList.remove('hidden');
            scheduleArrow.classList.add('rotate-180');
            updateDashboard();
        } else {
            scheduleContainer.classList.add('hidden');
            scheduleArrow.classList.remove('rotate-180');
        }
    });

    updateDashboard();
});

</script>
</body>
</html>